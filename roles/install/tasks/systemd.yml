---
- name: Install systemd
  package:
    name: systemd
    state: latest

- name: Install KF2 services
  template:
    src: "{{ item }}.service.j2"
    dest: "/etc/systemd/system/{{ item }}.service"
    owner: root
    group: root
    mode: '0644'
  loop:
    - kf2
    - kf2autokick
    - kf2watchdog
  notify: Reload systemd configuration

- name: Prepare systemd folder
  file:
    path: /etc/systemd/system/kf2.service.d
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: Install KF2 service extra files
  copy:
    src: serveradmin.patch
    dest: /etc/systemd/system/kf2.service.d/serveradmin.patch
    owner: root
    group: root
    mode: '0644'
  notify: Reload systemd configuration

- meta: flush_handlers

- name: Auto-start KF2 services on boot
  systemd:
    name: "{{ item }}"
    enabled: true
  loop:
    - kf2.service
    #- kf2autokick.service
    #- kf2watchdog.service
